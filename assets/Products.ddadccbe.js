import{_ as de,m as ye,r as $,c as j,w as _e,o as h,a as P,b as d,d as l,n as ce,J as O,t as M,e as S,f as Pe,u as J,g as we,s as te,h as G,i as Ve,j as m,k as a,F as B,l as xe,p as z,q as ae,v as oe,x as le,y as ue,z as Ue,A as ke,B as Ce,C as je}from"./index.67302387.js";import{C as Be,F as Me}from"./Field.a5e61fff.js";import{M as Se,C as $e}from"./CardComponent.a4c974a9.js";import{r as ne,s as re,u as De,g as Re}from"./firebase.4d311dc7.js";import{M as I}from"./velocity.min.5e3b6ff9.js";import{a as Ae}from"./brand.6711ee4a.js";import{f as Le}from"./formatPrice.580d6332.js";const Fe={class:"flex items-stretch justify-start relative"},Ne={class:"inline-flex"},Oe=["accept"],Te={key:0},qe={class:"inline-flex px-4 py-2 justify-center bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700 border rounded-r"},ze={props:{modelValue:{type:[Object,File,Array],default:null},label:{type:String,default:"Upload"},icon:{type:String,default:ye},accept:{type:String,default:null},color:{type:String,default:"info"}},emits:["update:modelValue"],setup(r,{emit:c}){const i=r,L=$(null),w=$(i.modelValue),D=j(()=>i.modelValue);_e(D,n=>{w.value=n,n||(L.value.input.value=null)});const k=n=>{const s=n.target.files||n.dataTransfer.files;w.value=s[0],c("update:modelValue",w.value)};return(n,s)=>(h(),P("div",Fe,[d("label",Ne,[l(O,{as:"a",label:r.label,icon:r.icon,color:r.color,class:ce({"rounded-r-none":w.value})},null,8,["label","icon","color","class"]),d("input",{ref_key:"root",ref:L,type:"file",class:"absolute top-0 left-0 w-full h-full opacity-0 outline-none cursor-pointer -z-1",accept:r.accept,onInput:k},null,40,Oe)]),w.value?(h(),P("div",Te,[d("span",qe,M(w.value.name),1)])):S("v-if",!0)]))}},Ee=de(ze,[["__file","/home/runner/work/watch-store-admin/watch-store-admin/src/components/FilePicker.vue"]]),U=Pe.create({baseURL:"https://perfume-8b21d-default-rtdb.firebaseio.com"});U.interceptors.request.use(function(r){return r},function(r){const c=J();return c.notificationState.type="error",c.notificationState.message="\u51FA\u73FE\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002",Promise.reject(r)});U.interceptors.response.use(function(r){return r},function(r){const c=J();return c.notificationState.type="error",c.notificationState.message="\u51FA\u73FE\u932F\u8AA4\uFF0C\u8ACB\u7A0D\u5F8C\u518D\u8A66\u3002",Promise.reject(r)});const Ge=r=>U.post("/products.json",r).then(c=>c.data),Ie=()=>U.get("/products.json").then(r=>r.data),Je=r=>U.get(`/product/${r}.json`).then(c=>c.data),He=(r,c)=>U.patch(`/products/${r}.json`,c).then(i=>i.data),se=(r,c)=>U.patch(`/product/${r}.json`,c).then(i=>i.data),Ke=(r,c)=>U.delete(`/products/${r}.json`,c).then(i=>i.data),Qe=(r,c)=>U.delete(`/product/${r}.json`,c).then(i=>i.data),We=we("product",()=>{const r=$([]),c=$([]);return{brands:r,products:c,createProduct:async s=>{try{const u={...s};delete u.imageUrl;const{name:f}=await Ge(u);return await se(f,{description:s.description,imageUrl:s.imageUrl,name:s.name,price:s.price*s.discount})}catch(u){throw u}},getBrands:async()=>{try{const s=await Ae(),u=Object.keys(s).map(f=>({...s[f],id:f}));r.value=u}catch(s){throw s}},getProducts:async()=>{try{const s=await Ie(),u=Object.keys(s).map(f=>({...s[f],id:f}));c.value=u}catch(s){throw s}},getProduct:async s=>{try{return await Je(s)}catch(u){throw u}},updateProduct:async({id:s,data:u})=>{const f={...u};delete f.imageUrl;const E={description:u.description,imageUrl:u.imageUrl,name:u.name,price:Math.floor(u.price*u.discount)};try{return await Promise.all([He(s,f),se(s,E)])}catch(F){throw F}},deleteProduct:async s=>{try{return await Promise.all([Ke(s),Qe(s)])}catch(u){throw u}}}}),Xe={class:"border-t border-b border-gray-100 bg-white p-6 dark:border-gray-900 dark:bg-gray-900/70 dark:text-white"},Ye=d("h1",{class:"text-3xl font-semibold leading-tight"},"Products",-1),Ze=d("thead",null,[d("tr",null,[d("th",null,"\u5546\u54C1\u5716\u7247"),d("th",null,"\u5546\u54C1\u540D\u7A31"),d("th",null,"\u54C1\u724C"),d("th",null,"\u50F9\u9322"),d("th")])],-1),et={"data-label":"\u5546\u54C1\u5716\u7247"},tt=["src","alt"],at={"data-label":"\u5546\u54C1\u540D\u7A31"},ot={"data-label":"\u54C1\u724C"},lt={"data-label":"\u50F9\u9322"},nt={class:"actions-cell"},rt={class:"border-t border-gray-100 p-3 dark:border-gray-800 lg:px-6"},st=["data-total"],dt=["src","alt"],ct=["data-total"],ut=["src","alt"],it=ue(" \u78BA\u5B9A\u8981\u522A\u9664"),mt=ue("\uFF1F "),pt={setup(r){const c=J(),i=We(),{darkMode:L,notificationState:w}=te(c),{products:D,brands:k}=te(i),n=G({id:"",data:{}}),s=({price:o,discount:e=1})=>Le(e?Math.floor(o*e):0),u=(o,e)=>{w.value={type:o,message:e},setTimeout(()=>{w.value={}},2e3)},f=()=>{n.id="",n.data={},y.value.length=0},E=o=>{C.value=o,Velocity(document.documentElement,"scroll",{offset:0,mobileHA:!1})},F=$(10),C=$(0),H=j(()=>D.value.slice(F.value*C.value,F.value*(C.value+1))),K=j(()=>Math.ceil(D.value.length/F.value)),ie=j(()=>C.value+1),me=j(()=>{const o=[];for(let e=0;e<K.value;e++)o.push(e);return o}),v=G({create:!1,info:!1,delete:!1}),Q=async({id:o,...e},g)=>{try{const{description:b,imageUrl:A}=await i.getProduct(o);v[g]=!0,n.id=o,n.data={...e,description:b,imageUrl:A},y.value=new Array(A.length).fill(null)}catch(b){console.error(b)}},R=j({get(){var o;return v.create?T.value[0]:{id:(o=k.value.find(e=>e.brand===n.data.brand))==null?void 0:o.id,label:n.data.fullBrand}},set({id:o}){const{brand:e,fullBrand:g}=k.value.find(b=>b.id===o);v.create?(p.brand=e,p.fullBrand=g):(n.data.brand=e,n.data.fullBrand=g)}}),T=j(()=>k.value.map(o=>({id:o.id,label:o.fullBrand}))),y=$([]),W=j(()=>y.value.map(o=>o?URL.createObjectURL(o):null)),X=()=>{const o=y.value.map(e=>{if(!e)return null;const g=ne(re,e.name);return De(g,e)});return Promise.all(o)},Y=()=>new Promise(o=>{let e=0;Array.from(y.value).forEach(async(g,b)=>{if(g){const A=ne(re,g.name),q=await Re(A).then(V=>V);n.data.imageUrl?(n.data.imageUrl[b]=q,n.data.url=imageUrl[0]):p.imageUrl[b]=q}e++,e===y.value.length&&o()})}),p=G({name:"",brand:"",fullBrand:"",description:"",price:"",discount:1,imageUrl:["https://fakeimg.pl/1080x1080/?text=photo","https://fakeimg.pl/1080x1080/?text=photo","https://fakeimg.pl/1080x1080/?text=photo","https://fakeimg.pl/1080x1080/?text=photo"],get url(){return this.imageUrl[0]}}),pe=()=>{var g;v.create=!0;const{id:o,label:e}=T.value[0];p.brand=(g=k.value.find(b=>b.id===o))==null?void 0:g.brand,p.fullBrand=e},fe=async()=>{try{y.value.length>0&&(await X(),await Y()),await i.createProduct(p),await i.getProducts(),u("success","\u65B0\u589E\u6210\u529F"),f(),Z()}catch(o){console.error(o)}},ge=()=>{f(),Z()},Z=()=>{Object.assign(p,{name:"",brand:"",fullBrand:"",description:"",price:"",discount:1,imageUrl:["https://fakeimg.pl/1080x1080/?text=photo","https://fakeimg.pl/1080x1080/?text=photo","https://fakeimg.pl/1080x1080/?text=photo","https://fakeimg.pl/1080x1080/?text=photo"]}),y.value.length=0},be=async()=>{try{await Promise.all([i.getBrands(),i.getProducts()])}catch(o){console.log(o)}},he=async()=>{try{await X(),await Y(),await i.updateProduct(n),await i.getProducts(),u("success","\u4FEE\u6539\u6210\u529F")}catch(o){console.error(o)}},ve=async()=>{try{await i.deleteProduct(n.id),await i.getProducts(),H.value.length===0&&C.value>0&&(C.value=C.value-1),u("success","\u522A\u9664\u6210\u529F"),f()}catch(o){console.error(o)}};return Ve(()=>{(!k.value.length||!D.value.length)&&be()}),(o,e)=>{const g=xe,b=Ue,A=$e,q=Se,V=Be,_=Me,ee=Ee;return h(),P(B,null,[d("section",Xe,[l(g,null,{default:m(()=>[Ye,l(O,{color:"white",label:"\u65B0\u589E\u5546\u54C1",onClick:pe})]),_:1})]),l(q,null,{default:m(()=>[l(A,{class:"mb-6","has-table":""},{default:m(()=>[d("table",null,[Ze,d("tbody",null,[(h(!0),P(B,null,z(a(H),(t,x)=>(h(),P("tr",{key:t.id,class:ce(["lg:hover:bg-gray-100",x%2===0?"lg:bg-gray-50":""])},[d("td",et,[d("img",{class:"h-24 w-24 object-cover",src:t.url,alt:t.name},null,8,tt)]),d("td",at,M(t.name),1),d("td",ot,M(t.fullBrand),1),d("td",lt,M(s(t)),1),d("td",nt,[l(b,{type:"justify-start lg:justify-end","no-wrap":""},{default:m(()=>[l(O,{color:"info",icon:a(ke),small:"",onClick:N=>Q(t,"info")},null,8,["icon","onClick"]),l(O,{color:"danger",icon:a(Ce),small:"",onClick:N=>Q(t,"delete")},null,8,["icon","onClick"])]),_:2},1024)])],2))),128))])]),S(" pagination "),d("div",rt,[l(g,null,{default:m(()=>[l(b,null,{default:m(()=>[(h(!0),P(B,null,z(a(me),t=>(h(),je(O,{key:t,active:t===C.value,label:t+1,outline:a(L),small:"",onClick:x=>E(t)},null,8,["active","label","outline","onClick"]))),128))]),_:1}),d("small",null,"Page "+M(a(ie))+" of "+M(a(K)),1)]),_:1})])]),_:1})]),_:1}),S(" \u65B0\u589E\u5546\u54C1 "),l(I,{modelValue:a(v).create,"onUpdate:modelValue":e[5]||(e[5]=t=>a(v).create=t),title:"\u65B0\u589E\u5546\u54C1",onConfirm:fe,onCancel:ge},{default:m(()=>[a(v).create?(h(),P(B,{key:0},[l(_,{label:"\u540D\u7A31",class:"mb-0"},{default:m(()=>[l(V,{modelValue:a(p).name,"onUpdate:modelValue":e[0]||(e[0]=t=>a(p).name=t),modelModifiers:{trim:!0},type:"text"},null,8,["modelValue"])]),_:1}),l(_,{label:"\u54C1\u724C"},{default:m(()=>[l(V,{modelValue:a(R),"onUpdate:modelValue":e[1]||(e[1]=t=>ae(R)?R.value=t:null),options:a(T)},null,8,["modelValue","options"])]),_:1}),l(_,{label:"\u63CF\u8FF0"},{default:m(()=>[l(V,{modelValue:a(p).description,"onUpdate:modelValue":e[2]||(e[2]=t=>a(p).description=t),modelModifiers:{trim:!0},type:"textarea"},null,8,["modelValue"])]),_:1}),d("div",{class:"flex items-center gap-4 after:self-end after:leading-[48px] after:content-['='attr(data-total)]","data-total":s(a(p))},[l(_,{label:"\u539F\u50F9",class:"mb-0"},{default:m(()=>[l(V,{modelValue:a(p).price,"onUpdate:modelValue":e[3]||(e[3]=t=>a(p).price=t),modelModifiers:{number:!0},type:"text"},null,8,["modelValue"])]),_:1}),l(_,{label:"\u6298\u6263",class:"mb-0"},{default:m(()=>[oe(d("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a(p).discount=t),type:"number",min:"0",max:"1",step:"0.01",class:"h-12 rounded border-gray-700 dark:bg-gray-800"},null,512),[[le,a(p).discount]])]),_:1})],8,st),l(_,{label:"\u4E0A\u50B3\u5716\u7247",class:"mb-0"},{default:m(()=>[(h(!0),P(B,null,z(a(p).imageUrl,(t,x)=>(h(),P("div",{key:t,class:"mt-4 flex items-center gap-4 first:mt-0"},[d("img",{src:a(W)[x]||t,class:"h-20 w-20 object-cover",alt:a(p).name},null,8,dt),l(ee,{modelValue:y.value[x],"onUpdate:modelValue":N=>y.value[x]=N,color:"white"},null,8,["modelValue","onUpdate:modelValue"])]))),128))]),_:1})],64)):S("v-if",!0)]),_:1},8,["modelValue"]),S(" \u4FEE\u6539\u5546\u54C1 "),l(I,{modelValue:a(v).info,"onUpdate:modelValue":e[11]||(e[11]=t=>a(v).info=t),title:"\u4FEE\u6539\u5546\u54C1",onConfirm:he,onCancel:f},{default:m(()=>[a(v).info?(h(),P(B,{key:0},[l(_,{label:"\u540D\u7A31",class:"mb-0"},{default:m(()=>[l(V,{modelValue:a(n).data.name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(n).data.name=t),modelModifiers:{trim:!0},type:"text"},null,8,["modelValue"])]),_:1}),l(_,{label:"\u54C1\u724C"},{default:m(()=>[l(V,{modelValue:a(R),"onUpdate:modelValue":e[7]||(e[7]=t=>ae(R)?R.value=t:null),options:a(T)},null,8,["modelValue","options"])]),_:1}),l(_,{label:"\u63CF\u8FF0"},{default:m(()=>[l(V,{modelValue:a(n).data.description,"onUpdate:modelValue":e[8]||(e[8]=t=>a(n).data.description=t),modelModifiers:{trim:!0},type:"textarea"},null,8,["modelValue"])]),_:1}),d("div",{class:"flex items-center gap-4 after:self-end after:leading-[48px] after:content-['='attr(data-total)]","data-total":s(a(n).data)},[l(_,{label:"\u539F\u50F9",class:"mb-0"},{default:m(()=>[l(V,{modelValue:a(n).data.price,"onUpdate:modelValue":e[9]||(e[9]=t=>a(n).data.price=t),modelModifiers:{number:!0},type:"text"},null,8,["modelValue"])]),_:1}),l(_,{label:"\u6298\u6263",class:"mb-0"},{default:m(()=>[oe(d("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>a(n).data.discount=t),type:"number",min:"0",max:"1",step:"0.01",class:"h-12 rounded border-gray-700 dark:bg-gray-800"},null,512),[[le,a(n).data.discount]])]),_:1})],8,ct),l(_,{label:"\u4E0A\u50B3\u5716\u7247",class:"mb-0"},{default:m(()=>[(h(!0),P(B,null,z(a(n).data.imageUrl,(t,x)=>(h(),P("div",{key:t,class:"mt-4 flex items-center gap-4 first:mt-0"},[d("img",{class:"h-20 w-20 object-cover",src:a(W)[x]||t,alt:a(n).data.name},null,8,ut),l(ee,{modelValue:y.value[x],"onUpdate:modelValue":N=>y.value[x]=N,color:"white"},null,8,["modelValue","onUpdate:modelValue"])]))),128))]),_:1})],64)):S("v-if",!0)]),_:1},8,["modelValue"]),S(" \u522A\u9664\u5546\u54C1 "),l(I,{modelValue:a(v).delete,"onUpdate:modelValue":e[12]||(e[12]=t=>a(v).delete=t),"large-title":"Please confirm",button:"danger","has-cancel":"",onConfirm:ve,onCancel:f},{default:m(()=>[d("p",null,[it,d("strong",null,"\u300C"+M(a(n).data.name)+"\u300D",1),mt])]),_:1},8,["modelValue"])],64)}}},Pt=de(pt,[["__file","/home/runner/work/watch-store-admin/watch-store-admin/src/views/Products.vue"]]);export{Pt as default};
